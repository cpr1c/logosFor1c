# logosFor1c

Подсистема сквозного логирования на клиенте и сервере в разные приемники.
За основу взята обработка https://github.com/codenull/log1c.

Позволяет задать несколько настроек логирования и использовать изолированно друг от друга. Притом настройки не нужно хранить в переменной

В перспективе есть мысли сделать переопределяемый программный интерфейс для добавления своих способов логирования

Распространяется в виде расширения. Ограничений по видам приложений и операционным системам нет

## Уровни логирования
1. НЕТ - Логирование не происходит
1. ОТЛАДКА
1. ИНФОРМАЦИЯ
2. ПРЕДУПРЕЖДЕНИЕ
3. ОШИБКА
4. КРИТИЧЕСКАЯОШИБКА

## Способы логирования
1. Консоль -  вывод в стандартные сообщения
2. ЖурналРегистрации
3. Память - работает только в конексте клиента
4. База - запись в специальный регистр сведений
5. Файл


# Использование

## Инициализация

1. Инициализация с настройками по умолчанию

```bsl
лЛог.НовыйЛог();
```

2. Инициализация по наименованию настройки

```bsl
лЛог.НовыйЛог(Наименование);
```

Далее все логирование должно идти с указанием имени лога

## Особенности изменения настроек лога на сервере
Ввиду технологических ограничений (невозможности использовать параметров сеанса в расширении), пришлось реализовать отдельные хранилища для клиента и сервера.
При создании/настройке лога на клиенте, настройки автоматически обновляются на сервере.

При инициализации лога или изменении его настроек на сервере, после заверешение серверного вызова нужно на клиенте вызвать метод

```bsl
лЛог.ОбновитьЛогиНаКлиентеПоДаннымСервера();
```



## Уровни логирования и основные методы
В подсистеме используется следующие (по возрастанию приоритета):
1. НЕТ - Логирование не происходит
1. ОТЛАДКА
1. ИНФОРМАЦИЯ
2. ПРЕДУПРЕЖДЕНИЕ
3. ОШИБКА
4. КРИТИЧЕСКАЯОШИБКА

По умолчанию используется уровень логирования ИНФОРМАЦИЯ. При установке какого-либо уровня, в лог будут выводиться только сообщения этого уровня и уровней с большим приоритетом. Например, если установлен уровень ПРЕДУПРЕЖДЕНИЕ то будут выводиться сообщения следующих уровней: ПРЕДУПРЕЖДЕНИЕ, ОШИБКА, КРИТИЧЕСКАЯОШИБКА.

Уровень логирования можно изменить с помощью метода *УстановитьУровеньЛогирования()*:

```bsl
лЛог. УстановитьУровеньЛогирования("Ошибка");
лЛог. УстановитьУровеньЛогирования("Ошибка", "НеОсновнойЛог");
```

## Вывод сообщений в лог

Каждому уровню логирования соответствует свой метод вывода информации:

```bsl
лЛог.Отл_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Пред_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Инф_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Ош_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Крит_("Отладочное сообщение", ИмяЛога = Неопределено);
```

Так же есть длинные варианты тех же методов

```bsl
лЛог.Отладка_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Информация_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Предупреждение_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.Ошибка_("Отладочное сообщение", ИмяЛога = Неопределено);
лЛог.КритическаяОшибка_("Отладочное сообщение", ИмяЛога = Неопределено);
```

Имя события логирования записывается как "Логирование.<ИмяЛога>"

## Способы логирования
Поддерживаются следующие способы:
* Консоль -  вывод в стандартные сообщения
* ЖурналРегистрации
* Память - работает только в конексте клиента
* База - запись в специальный регистр сведений
* Файл


```bsl
лЛог.ДобавитьСпособЛогирования(Способ, Параметры, ЛогИлиИмяЛога = Неопределено, Контекст = "");
```

Параметры способа логирования можно получить методом:
```bsl
лЛог.ПараметрыСпособаЛогирования(Способ);
```

Для типовых способов логирования предусмотрены специфичные методы добавления в лог


```bsl
лЛог.ДобавитьСпособЛогированияКонсоль(ЛогИлиИмяЛога = Неопределено, Контекст = "");
лЛог.ДобавитьСпособЛогированияБаза(ЛогИлиИмяЛога = Неопределено, Контекст = "");
лЛог.ДобавитьСпособЛогированияЖурналРегистрации(ЛогИлиИмяЛога = Неопределено, Контекст = "");
лЛог.ДобавитьСпособЛогированияПамять(ЛогИлиИмяЛога = Неопределено, Контекст = "");
лЛог.ДобавитьСпособЛогированияФайл(ИмяФайла, ЛогИлиИмяЛога = Неопределено, Контекст = "");
```

## Контекст для способа логирования
Для каждого способа логирования можно указать контекст в котором данный способ срабатывать.
Сейчас доступно:
* Клиент - Логирование для способа происходит только на клиенте
* Сервер - Логирование для способа происходит только на сервере
* КлиентСервер или пустой контекст - фильтр по контексту не применяется

Например,
```bsl
лЛог.ДобавитьСпособЛогированияКонсоль(, "Клиент"); //ЛОгирование для лога по умолчанию в консоль будет выполняться только на клиенте
лЛог.ДобавитьСпособЛогированияБаза(, "Сервер"); //Логирование для лога по умолчанию в базу будет только на сервере
```
## Управление логированием

* Отключение логирования для лога. В этом логирование по данному логу прекращается, но все настройки сохраняются
```bsl
лЛог.Отключить(ЛогИлиИмяЛога = Неопределено);
```

* Включение логирования для лога после отключения.
```bsl
лЛог.Включить(ЛогИлиИмяЛога = Неопределено);
```

Это может быть удобным, если требуется отключить логи на определенном участке кода.

* Завершение логирования для лога. Удаление настройки лога из актуальных

```bsl
лЛог.ЗавершитьЛогирование(ЛогИлиИмяЛога = Неопределено);
```

* Получения текущих настроек логов
  ```bsl
лЛог.АктивныеЛоги();
```

* Удаление всех настроек логов. Остановка всего логирования 
  ```bsl
лЛог.ОчиститьСписокЛогов();
```

* Получение данных лога для способа логирования Память
    ```bsl
лЛог.ДанныеЛога(ЛогИлиИмяЛога = Неопределено);
```

# Особенности

1. Что будет если лог не проинициализирован и по нему происходит настройка и дальнейшее логирование?

    > Логирование не будет произведено. Ошибок не выдасться

2. Что будет если два раза добавить способ логирования База с разными контекстами?
   > Логирование будет просходить по самому первому заданному контексту




# Другие решения
* Обработка для логирования из одного объекта (обработки): https://github.com/codenull/log1c
* Модуль logos из OneScript: https://github.com/oscript-library/logos
* Подсистема логирования на базе модуля logos: https://github.com/1823244/logos-1c